Using attention to model long-term dependencies in
occupancy behavior
Max Kleinebrahm
Chair of Energy Economics
Karlsruhe Institute of Technology
Karlsruhe, Germany
max.kleinebrahm@kit.eduJacopo Torriti
School of the Built Environment
University of Reading
Reading, United Kingdom
j.torriti@reading.ac.uk
Russell McKenna
Chair in Energy Transition
University of Aberdeen
Aberdeen, United Kingdom
russell.mckenna@abdn.ac.ukArmin Ardone
Chair of Energy Economics
Karlsruhe Institute of Technology
Karlsruhe, Germany
armin.ardone@kit.edu
Wolf Fichtner
Chair of Energy Economics
Karlsruhe Institute of Technology
Karlsruhe, Germany
wolf.fichtner@kit.edu
Abstract
Models simulating household energy demand based on different occupant and
household types and their behavioral patterns have received increasing attention
over the last years due the need to better understand fundamental characteristics
that shape the demand side. Most of the models described in the literature are
based on Time Use Survey data and Markov chains. Due to the nature of the
underlying data and the Markov property, it is not sufﬁciently possible to consider
day to day dependencies in occupant behavior. An accurate mapping of day to
day dependencies is of increasing importance for accurately reproducing mobility
patterns and therefore for assessing the charging ﬂexibility of electric vehicles. This
study bridges the gap between energy related activity modelling and novel machine
learning approaches with the objective to better incorporate ﬁndings from the ﬁeld
of social practice theory in the simulation of occupancy behavior. Weekly mobility
data are merged with daily time use survey data by using attention based models.
In a ﬁrst step an autoregressive model is presented, which generates synthetic
weekly mobility schedules of individual occupants and thereby captures day to
day dependencies in mobility behavior. In a second step, an imputation model is
presented, which enriches the weekly mobility schedules with detailed information
about energy relevant at home activities. The weekly activity proﬁles build the
basis for modelling consistent electricity, heat and mobility demand proﬁles of
households. Furthermore, the approach presented forms the basis for providing
data on socio-demographically differentiated occupant behavior to the general
public.
Tackling Climate Change with Machine Learning workshop at NeurIPS 2020.1 Introduction
Occupant behavior has been identiﬁed as having a signiﬁcant impact on household energy consump-
tion [ 12]. Therefore, there has been an increasing research interest in the ﬁeld of behavioral modelling
over the last years with the aim to explain dynamics in residential energy demand based on energy
related activities [ 13,14]. A large number of studies focus on the modelling of activity sequences of
single households or individuals with the objective to describe occupant behavior on an aggregated
level for socio-demographic differentiated groups [ 10,17,6,1]. Time use data (TUD) are used as a
data basis, which provide information on the temporal course of occupant activities over single days
and are available for various countries in the form of population representative samples [ 4]. Based
on occupant behavior, different approaches were developed that connect occupant activities with
electrical household appliances and thus generate synthetic electricity demand proﬁles [ 18]. The aim
of these studies is to gain a deeper understanding of household electricity demand in order to e.g. be
able to evaluate device-speciﬁc efﬁciency measures, time-dependent electricity tariffs or load shift
potentials.
In the course of the decarbonisation of domestic heat demand, it is expected that a large part of the
heat will be generated by electricity (e.g. through heat pumps). In order to decarbonise the mobility
sector, the aim is to increase the amount of electric vehicles in e.g. Germany from 53,861 in 2018
to 6,000,000 by 2030 [ 7,2]. Due to the mentioned developments, fundamental characteristics will
change in the course of energy demand in the household sector. Furthermore, the introduction of
stationary and mobile electricity storage systems as well as stationary heat storage systems enable
the storage of energy over periods of single days and therefore open up ﬂexibility potentials in the
residential sector, which can support the integration of ﬂuctuating renewable energies. To evaluate
these ﬂexibility potentials, data are required that contain information about the mobility behavior of
individuals over several days and about their energy relevant at home activities. TUD only provide
information on activity patterns of two or three individual days, therefore longer-term dependencies
in behavior that extend over several days are not captured in existing TUD based models [ 13]. The
objective of this study is to develop an approach which captures long-term dependencies in behavior
in order to be able to provide high quality mobility and activity data of individuals to the general
public.
Therefore, the paper is structured as follows. Section 2 provides an overview of the literature in the
ﬁeld of categorical (activity) sequence modelling. Section 3 explains the methodology introduced to
capture long-term dependencies in occupancy behavior, before Section 4 presents and discusses the
results. The conclusion can be found in Section 5.
2 Categorical (activity) sequence modelling
Activity schedules are categorical time series in which the state space is deﬁned on the basis of the
possible activity states that a person can be in. The most commonly used approaches to model activity
sequences is to describe them as Markov chains. [ 10] developed an approach which uses a ﬁrst order
Markov chain and distinguishes between the states ‘active at home’ and ‘not active at home’ for each
person of a household. First order Markov models are adequately suited to describe processes that full
ﬁll the Markov property, which refers to the memorylessness of a stochastic process. This means that
the transition to a subsequent state depends only on the current state and is independent of previously
observed states. It is obvious that residential activity schedules represent more complex processes
and therefore cannot easily be represented by a ﬁrst order Markov model. To overcome this problem,
a variety of more complex Markov models have been presented in recent years (semi-Markov [ 17],
higher order [ 6], variable memory length [ 8]). However, two serious remain with higher-order
Markov chains. The number of free parameters in the model increases exponentially with the order
of the model and the collection of all possible full high-order Markov chain models is limited and
completely stratiﬁed. Due to these issues, Markov models are not used in this study. Social practice
theory literature points out that in order to understand people’s daily/weekly activity schedules these
should be treated as a whole [ 11,14]. As a result, model approaches are required whose memory
mechanisms enables complex relationships in human behavior to be recorded as comprehensively as
possible.
Attention based neural networks represent the state of the art in the rapidly developing ﬁeld of natural
language processing (NLP) over the past years [ 15,3]. In these networks language is interpreted as
2categorical sequences in which letters or words represent states. attention based models have shown
that they can learn complex long-term dependencies in language and are therefore promising for the
application in this study.
3 Generation of synthetic weekly activity schedules
Figure 1 describes the architecture of the two step approach presented in this study to combine weekly
mobility schedules with daily activity schedules for the generation of synthetic weekly activity
schedules, which combine the advantages of both datasets. For the application in this study, data
from the German Mobility Panel (MOP) and German time use data (TUD) are used. The datasets are
described in the appendix in Section 6.1.
ab?c
?b?a
abcd bcAutoregressive model Imputation modelpredicttrain
?b?a
ab?ctraininput
predict
Mobility dataset
Activity dataset
Synthetic weekly
mobility schedules
…Synthetic weekly
activity & mobility
schedules
Figure 1: Visualization of the two step approach for the generation of weekly activity schedules
The autoregressive model tries to capture the stochasticity in mobility behavior and to generate, step by
step, synthetic mobility schedules that have identical properties as the empirical data. Mobility state
information is provided as input in 10-minute resolution, with six mobility states being distinguished
from one another (see Figure 3). In contrast to recurrent models (e.g. LSTM models), the temporal
relationships in time series must be learned from scratch. To make this easier, timestamp information
is provided to the model in the form of sinusoidal position encoding [ 15] as well as weekday
embeddings (see Figure 4). Weekday embeddings are multi-dimensional representations of the
weekdays in a continuous space, which are learned during the training process. In this way, daily and
weekly rhythms in behavior and differences in behavior on work and weekend days can be learned
more easily. Since the socio-demographic composition of both data sets differ and in order to be able
to generate socio-demographically differentiated activity schedules, information about the age and
occupation type is provided in the form of seven age classes and seven occupation classes. After
all time-step-speciﬁc information are concatenated, they ﬂow into the main part of the attention
based autoregressive model, which is shown in Figure 5. By using the self-attention mechanism, all
dependencies between the 1008 10-minute time steps are learned during the training process. The
use of the look-ahead mask ensures that only information from previous time steps is used when
predicting the mobility state of the next time step.
The imputation model enriches the “at home” state in the generated mobility schedules by distinguish-
ing between ten different energy relevant at home activities (see in Figure 3). During the training
process TUD are used which provide activity information about maximum three weekdays (from 4
am to 4 am) for each individual (see Figure 4). In contrast to the autoregressive model, no look-ahead
mask is used in the imputation model, since the model is supposed to use information about future
mobility states while predicting current at home states. Therefore, only future at home states are
masked during the training process, so that the attention matrix calculates all dependencies between
the unknown at home state under consideration and all mobility states as well as all known (previous)
energy relevant at home states. By using all three days per individual in one sample during the
training process, the model is able to learn day-to-day dependencies between at home activities (e.g.
3Attention 
Empirical
Markova.) Hamming distance working days
 c.) Schedule ( age: 51-60, occ.: fulltime)
 b.) Autocorrelation (driving car)
Attention EmpiricalFigure 2: Visualization of the distribution of the hamming distance between all working days (a.), the
autocorrelation of the state driving car (b.) and an example synthetic activity schedule (c.)
people go to bed or eat at similar times on consecutive days). During the prediction process, the
entire weekly mobility plan is given as input and the at home activities are enriched chronologically.
Both models are trained using the cross entropy loss function and the Adam optimizer. The datasets
are split up into training data (9-fold cross validation (80 % training, 10 % validation)) and test data
(10 %). The generated mobility and activity schedules are constantly evaluated on an individual and
aggregated level by calculating the aggregated state probability, the distribution of state durations, the
autocorrelation, the amount of weekly activities for each state and the distribution of the hamming
distance between all working days over all generated samples.
4 Results
The model conﬁgurations used for the results in Figure 2 can be found in Table 1 (model no. 3) and
Table 2 (model no. 4). As a reference model for the autoregressive mobility schedule generation,
a 1st order Markov model is used. The 1st order Markov model characteristics are representative
for the models presented in section 2, since marginal changes in the metrics can be achieved by
using more complex Markov chains, but the basic problems remain (no long-term memory). From
the visualization of the distribution of the hamming distances between the ﬁve working days of
the week, it can be seen that the attention based models depict similar behavior between the days
well, in contrast to the Markov model, in which working days of individuals are not as similar as
in the empirical data. In the course of the autocorrelation of the driving car state (Figure 2 b.) a
peak can be seen after 144 10-minute intervals (24 hours). This peak can be explained by daily
rhythms in the commuting behavior of car drivers. From the distribution of the Hamming distance
and the 25/75% quantiles of the autocorrelation, it can be seen that both the diversity between
individuals and the average mobility behavior are captured by the model. The described day to day
dependencies can also be recognized in the exemplary activity plan in Figure 2 c. The person under
consideration leaves home during working days at around the same time and sleeps a bit longer on
the weekend. In Tables 1 and 2, error values are given for the various metrics in comparison to the
empirical data. In contrast to Markov models, which, based on their structure, meet aggregate state
probabilities and the average number of weekly activities well, the attention based models reﬂect
intrapersonal dependencies signiﬁcantly better, which can be seen by the lower errors in the duration
of the states, the autocorrelation and the Hamming distance. The errors of the attention-based model
in the aggregated state probabilities are, as can be seen from Table 1 and Table 2, slightly higher than
those of the Markov model, in which the error tends to zero with increasing sample size. However,
the average error in the aggregated state probability over all socio-demographic groups between
the generated data and the empirical mobility data is more than two times lower than the error that
arises when comparing the overlapping states of the two input data sets. It can be concluded that the
approach presented enables to combine the advantages of weekly mobility data with a large sample
size with the advantages of high-resolution activity data of individual days, thus creating a new data
basis which can be used for further analyses of human occupancy and mobility behavior.
45 Conclusion
Over the past years, more and more models have been published that aim to capture relationships
in human residential behavior. Most of these models are different Markov variants or regression
models that have a strong assumption bias and are therefore unable to capture complex long-term
dependencies and the diversity in occupant behavior. This work shows that attention based models
are able to capture complex long-term dependencies in occupancy behavior and at the same time ade-
quately depict the diversity in behavior across the entire population and different socio-demographic
groups. By combining an autoregressive generative model with an imputation model, the advantages
of two data sets are combined and new data are generated which are beneﬁcial for multiple use cases
(e.g. generation of consistent household energy demand proﬁles). The two step approach generates
synthetic activity schedules that have similar statistical properties as the empirical collected schedules
and do not contain direct information about single individuals. Therefore, the presented approach
forms the basis to make data on occupant behavior freely available, so that further investigations
based on the synthetic data can be carried out without a large data application effort. In future work
it is planned to take interpersonal dependencies into account in order to be able to generate entire
household behavior proﬁles.
Acknowledgments and Disclosure of Funding
This work was supported by the Helmholtz Association under the Joint Initiative “Energy Systems
Integration” (funding reference: ZT-0002) and was done during a research stay funded by the Centre
for Research into Energy Demand Solutions (CREDS) at the University of Reading (UK). This work
was supported by UKRI [grant numbers EP/R000735/1, EP/R035288/1 and EP/P000630/1].
References
[1]D. Aerts, J. Minnen, I. Glorieux, I. Wouters, and F. Descamps. A method for the identiﬁca-
tion and modelling of realistic domestic occupancy sequences for building energy demand
simulations and peer comparison. Building and Environment , 75:67–78, 2014.
[2]BMWi, BMVBS, BMU, and BMBF. Regierungsprogramm elektromobilität: technical report,
2011.
[3]Tom B. Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared Kaplan, Prafulla Dhariwal,
Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, Sandhini Agarwal, Ariel
Herbert-V oss, Gretchen Krueger, Tom Henighan, Rewon Child, Aditya Ramesh, Daniel M.
Ziegler, Jeffrey Wu, Clemens Winter, Christopher Hesse, Mark Chen, Eric Sigler, Mateusz
Litwin, Scott Gray, Benjamin Chess, Jack Clark, Christopher Berner, Sam McCandlish, Alec
Radford, Ilya Sutskever, and Dario Amodei. Language models are few-shot learners, 28.05.2020.
[4] Eurostat. Harmonized european time of use survey. 2000.
[5]Eurostat. Final energy consumption in the residential sector by use, eu-28: Statistics ecplained,
2019.
[6]Graeme Flett and Nick Kelly. An occupant-differentiated, higher-order markov chain method
for prediction of domestic occupancy. Energy and Buildings , 125:219–230, 2016.
[7]Kraftfahrt-Bundesamt. Bestand an pkw in den jahren 2009 bis 2018 nach ausgewählten
kraftstoffarten, 2020.
[8]José Luis Ramírez-Mendiola, Philipp Grünewald, and Nick Eyre. Residential activity pattern
modelling through stochastic chains of variable memory length. Applied Energy , 237:417–430,
2019.
[9]RDC of the Federal Statistical Ofﬁce and Statistical Ofﬁces of the Länder. Zeitbudgeterhebung
2001 and 2002, own calculations, 2002.
[10] Ian Richardson, Murray Thomson, and David Inﬁeld. A high-resolution domestic building
occupancy model for energy demand simulations. Energy and Buildings , 40(8):1560–1566,
2008.
[11] Elizabeth Shove, Mika Pantzar, and Matt Watson. The Dynamics of Social Practice: Everyday
Life and How it Changes . SAGE Publications Ltd, 2012.
5[12] Koen Steemers and Geun Young Yun. Household energy consumption: A study of the role of
occupants. Building Research & Information , 37(5-6):625–637, 2009.
[13] Jacopo Torriti. A review of time use models of residential electricity demand. Renewable and
Sustainable Energy Reviews , 37:265–272, 2014.
[14] Jacopo Torriti. Understanding the timing of energy demand through time use data: Time of the
day dependence of social practices. Energy Research & Social Science , 25:37–47, 2017.
[15] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez,
Lukasz Kaiser, and Illia Polosukhin. Attention is all you need. 2017.
[16] Christine Weiß, Bastian Chlond, Tim Hilgert, and Peter V ortisch. Deutsches mobilitätspanel
(mop) - wissenschaftliche begleitung und auswertungen, bericht 2014/2015: Alltagsmobilität
und fahrleistung.
[17] Urs Wilke. Probabilistic bottom-up modelling of occupancy and activities to predict electricity
demand in residential buildings: Phd thesis. 2013.
[18] Y . Yamaguchi, S. Yilmaz, N. Prakash, S. K. Firth, and Y . Shimoda. A cross analysis of existing
methods for modelling household appliance use. Journal of Building Performance Simulation ,
12(2):160–179, 2018.
[19] D. Zumkeller and B. Chlond. Dynamics of change: Fifteen-year german mobility panel, 2009.
Broader impact on climate change
In 2017, the residential sector accounted for 27% of European ﬁnal energy consumption (mobility
excluded) and therefore takes a key role in achieving European climate targets [ 5]. Approximately
64% of the residential ﬁnal energy demand can be attributed to space heating demand, 15% to
domestic hot water demand and 20% to the demand for lighting, cooking and appliances [ 5]. In
the course of the decarbonisation of domestic heat demand, it is expected that a large part of the
heat will be generated by electricity (e.g. through heat pumps). In order to decarbonise the mobility
sector, the aim is to increase the amount of electric vehicles in Germany from 53,861 in 2018 to
6,000,000 by 2030 [ 7,2]. Due to the mentioned developments and an expected further increase in
photovoltaic battery systems in the residential sector, fundamental characteristics will change in the
course of energy demand in the household sector. Therefore, residential neighbourhoods are gaining
increased attention by policy makers. In order to establish targeted policy interventions for different
households, which allow an optimal integration of low carbon technologies and open up ﬂexibility
options on the demand side, fundamental factors inﬂuencing the structure of energy demand must
be understood. The diversity and differences in electricity and heat consumption between different
households/buildings is a major obstacle to understanding future energy consumption.
Broader impact regarding ethical aspects
When providing behavioral data, ethical aspects such as data privacy must be taken into account at all
times. The data sets used in this work do not allow any conclusions to be drawn back to individuals.
However, before the synthetic data are made available online, differential privacy of the models must
be ensured.
The data set provided by this work can support energy system planners, for example in predicting
future load peaks due to high electrical demand at certain times. Furthermore, politicians can be
supported in the introduction of variable electricity tariffs so that they do not favor or disadvantage
different socio-demographic groups.Based on the behavior of different socio-demographic groups, the
data could be used in the marketing sector to target speciﬁc groups that increasingly watch television
at certain times. When using synthetic data, it must also be taken into account that models always
lead to errors and that the synthetic data therefore differ from the empirically collected data, which
are also subject to certain biases. This study particularly points out that the two basic data sets differ
relatively strongly in terms of the composition of the socio-demographic groups. This is taken into
account when generating the synthetic data by using socio-demographic factors age and occupation
status while merging the datasets.
66 Appendix
6.1 Data
Information about the weekly mobility behavior is taken from the German Mobility Panel (MOP)
which collects information about each travel activity of about 1,500 to 3,100 individuals since 1994
every year [ 16,19]. In this study 26,610 weekly mobility schedules from the years 2001 till 2017
together with their associated socio-demographic information (age, occupation) are used as input.
Information about energy relevant at home activities is taken from the Harmonized European Time
Use Survey [ 9,4]. Activity diaries and socio-demographic information of 11,921 individuals out of
5,443 households are used to train the imputation model. Most of the participants provide diaries on
two weekdays and one weekend-day in 10-minute resolution. Figure 3 shows the temporal course of
the aggregated state probability over the entire dataset population and an exemplary mobility and
activity schedule.
6.2 Figures and tables
Aggregated state probability (MOP) Aggregated state probability (TUD)
Individual mobility schedule
(exemplary visualization )
Individual activity schedule
(exemplary visualization )
Figure 3: Visualization of aggregated state probabilities based on the MOP [ 16] and german TUS [ 9]
and exemplary artiﬁcial individual diary entries
7… Time of
day/week
(τt)Embedding Embedding… τ1 τ2 τ432
Day of
week
(dt)Activity
state
(asp,t)Job (sd 2,p)Embedding
Age (sd 1,p)EmbeddingEmbeddingConcatenation
… Time of
day/week
(τt)Embedding Embedding… τ0 τ1 τ1007
Day of
week
(dt)Mobility 
state
(ms p,t)Job (sd 2,p)
Embedding
Age (sd 1,p)EmbeddingEmbeddingConcatenationa.) Autoregressive model b.) Imputation modelFigure 4: Visualization of the training input of the autoregressive model and imputation model and
visualization of their ﬁrst layers
Masked self-attention
Input layersDense Dense … Dense
Transformer layer (Nx)Dense Dense … Densemsp,1 msp,2 ms… msp,1008
2x
Dense Dense Dense1x
QKVmask
Figure 5: Attention based autoregressive model architecture (residual connections are not visualized)
8Input layers
Transformer layer (1x)Dense Dense … Denseasp,1 asp,2 as… asp,432
Q
KVMasked attentionDense Dense … Dense 2x
Dense Dense Dense1xmask= unknown state asp,tMasked attentionDense Dense … Dense 2x
Dense Dense Dense1xmask
KVQ
Transformer layer (Nx)Figure 6: Attention based imputation model architecture (residual connections are not visualized)
Table 1: Hyperparameter conﬁgurations and metrics for the attention based autoregressive model.
Metrics are calculated using N = 2,000 samples.
No. layers/ sp sd ac na hd loss acc. epoch
d_model/ rmse rmse rmse mae mae
learning rate/ [%] [%] [-] [-] [-] [-] [%] [-]
batch size/
1 1/64/0.001/64 0.83 0.31 1.32 2.96 244 0.14 95.95 9
2 4/64/0.001/64 0.91 0.16 0.70 2.53 33 0.128 96.34 15
3 8/64/0.001/64 0.86 0.17 0.54 3.6 5 0.127 96.36 7
4 4/128/0.001/128 0.89 0.24 0.59 3.60 9 0.128 96.33 6
1st order Markov 0.53 0.53 3.79 0.73 908
Table 2: Hyperparameter conﬁgurations and metrics for the attention based imputation model. Metrics
are calculated using N = 2,000 samples.
No. layers/ sp sd ac na loss acc. epoch
d_model/ rmse rmse rmse mae
learning rate/ [%] [%] [-] [-] [-] [%] [-]
batch size/
1 1/64/0.001/256 0.58 0.39 0.50 0.50 0.469 86.97 158
2 4/64/0.001/256 0.58 0.39 0.44 0.62 0.436 87.32 22
3 4/64/0.001/64 0.57 0.38 0.36 0.90 0.436 87.35 8
4 4/64/0.0005/128 0.49 0.39 0.39 0.66 0.431 87.41 37
9(age< 18)
 (fulltime)Figure 7: The top two ﬁgures represent the course of the aggregated state probability for 1,500
generated activity schedules for persons under 18 years of age and for full time employees. The
lower two representations are two exemplary activity schedules for a person under the age of 18 and
a full-time employee (a legend can be found in Figure 3)
10